<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌿 Mnemonic Master - BIP39 GitHub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --accent: #3b82f6;
            --accent-light: #60a5fa;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --valid: #10b981;
            --invalid: #ef4444;
            --duplicate: #9ca3af;
            --console-bg: #0f172a;
            --console-text: #e2e8f0;
            --card-border: #475569;
            --hover: #374151;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Header Styles */
        .header {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
            border: 1px solid var(--card-border);
        }

        .title-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            font-size: 32px;
            color: var(--accent);
        }

        .title {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent);
        }

        .subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            margin-left: 10px;
        }

        .status-badge {
            background: var(--bg-tertiary);
            padding: 8px 16px;
            border-radius: 50px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-connected {
            color: var(--success);
        }

        .status-disconnected {
            color: var(--danger);
        }

        /* Stats Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
            border: 1px solid var(--card-border);
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-title {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
        }

        /* Control Panel */
        .control-panel {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
            border: 1px solid var(--card-border);
        }

        .panel-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        select, input {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            padding: 12px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s ease;
        }

        select:focus, input:focus {
            border-color: var(--accent);
        }

        .buttons-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            font-size: 14px;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-light);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-purple {
            background: #8b5cf6;
            color: white;
        }

        .btn-purple:hover {
            background: #7c3aed;
        }

        /* Tabs */
        .tabs-container {
            background: var(--bg-secondary);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
            border: 1px solid var(--card-border);
            margin-bottom: 20px;
        }

        .tabs-header {
            display: flex;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--card-border);
        }

        .tab {
            padding: 16px 24px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s ease;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            background: var(--accent);
            border-bottom: 3px solid var(--accent-light);
        }

        .tab:hover:not(.active) {
            background: var(--hover);
        }

        .tab-content {
            display: none;
            padding: 0;
            height: 450px;
        }

        .tab-content.active {
            display: block;
        }

        .tab-toolbar {
            padding: 15px 20px;
            background: var(--bg-tertiary);
            display: flex;
            gap: 15px;
            border-bottom: 1px solid var(--card-border);
        }

        .console {
            background: var(--console-bg);
            color: var(--console-text);
            font-family: 'Consolas', 'Monaco', monospace;
            padding: 20px;
            height: calc(100% - 65px);
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 14px;
        }

        .console-line {
            margin-bottom: 5px;
            line-height: 1.5;
        }

        .timestamp {
            color: var(--text-secondary);
        }

        .valid {
            color: var(--valid);
        }

        .invalid {
            color: var(--invalid);
        }

        .duplicate {
            color: var(--duplicate);
        }

        /* Status Bar */
        .status-bar {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
            border: 1px solid var(--card-border);
        }

        .status-text {
            color: var(--text-secondary);
        }

        .progress-container {
            width: 200px;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s ease;
        }

        .memory-usage {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--card-border);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
        }

        .close-modal:hover {
            color: var(--text-primary);
        }

        .modal-body {
            margin-bottom: 25px;
        }

        .modal-textarea {
            width: 100%;
            height: 150px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: none;
            margin-bottom: 15px;
        }

        .modal-result {
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .stats-container {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .stats-container {
                grid-template-columns: 1fr 1fr;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .buttons-container {
                flex-direction: column;
            }
            
            .tabs-header {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: 120px;
                justify-content: center;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .tab {
                min-width: 100%;
            }
        }

        /* Animations */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-light);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="title-container">
                <div class="logo">🌿</div>
                <div>
                    <h1 class="title">Mnemonic Master BIP39</h1>
                    <p class="subtitle">Com palavras oficiais do GitHub</p>
                </div>
            </div>
            <div class="status-badge" id="connection-status">
                <i class="fas fa-circle status-disconnected"></i>
                <span>Desconectado</span>
            </div>
        </header>

        <!-- Stats Cards -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-title"><i class="fas fa-chart-bar"></i> Frases Geradas</div>
                <div class="stat-value" id="stat-phrases">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-title"><i class="fas fa-clock"></i> Tempo Decorrido</div>
                <div class="stat-value" id="stat-time">0s</div>
            </div>
            <div class="stat-card">
                <div class="stat-title"><i class="fas fa-tachometer-alt"></i> Velocidade</div>
                <div class="stat-value" id="stat-speed">0 frases/s</div>
            </div>
            <div class="stat-card">
                <div class="stat-title"><i class="fas fa-check-circle"></i> Válidas</div>
                <div class="stat-value" id="stat-valid">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-title"><i class="fas fa-wallet"></i> Carteiras com Saldo</div>
                <div class="stat-value" id="stat-wallets">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-title"><i class="fas fa-copy"></i> Duplicatas</div>
                <div class="stat-value" id="stat-duplicates">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-title"><i class="fas fa-percentage"></i> Eficiência</div>
                <div class="stat-value" id="stat-efficiency">0%</div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <h2 class="panel-title"><i class="fas fa-sliders-h"></i> Configurações BIP39</h2>
            
            <div class="controls-grid">
                <div class="control-group">
                    <label class="control-label">Tamanho da Frase</label>
                    <select id="phrase-size">
                        <option value="12">12 palavras</option>
                        <option value="15">15 palavras</option>
                        <option value="18">18 palavras</option>
                        <option value="21">21 palavras</option>
                        <option value="24">24 palavras</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label class="control-label">Idioma</label>
                    <select id="language">
                        <option value="english">English</option>
                        <option value="portuguese">Português</option>
                        <option value="spanish">Español</option>
                        <option value="french">Français</option>
                        <option value="italian">Italiano</option>
                        <option value="japanese">日本語</option>
                        <option value="korean">한국어</option>
                        <option value="chinese_simplified">中文(简体)</option>
                        <option value="chinese_traditional">中文(繁體)</option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="control-label">URL do Ganache</label>
                    <input type="text" id="ganache-url" value="http://127.0.0.1:8545" placeholder="URL do Ganache">
                </div>

                <div class="control-group">
                    <label class="control-label">Webhook Discord</label>
                    <input type="text" id="discord-webhook" value="https://discord.com/api/webhooks/1410016730071175381/JdmZ3A1012y_racgHI7nD1vlXQdFS4_nlQnqLVwoJF3vueL5fYUCVE3DMUv1PU97n4BO" placeholder="Webhook do Discord">
                </div>
            </div>
            
            <div class="buttons-container">
                <button class="btn btn-primary" id="start-btn">
                    <i class="fas fa-play"></i> Iniciar Geração
                </button>
                <button class="btn btn-danger" id="stop-btn">
                    <i class="fas fa-stop"></i> Parar
                </button>
                <button class="btn btn-warning" id="clear-btn">
                    <i class="fas fa-broom"></i> Limpar
                </button>
                <button class="btn btn-success" id="validate-btn">
                    <i class="fas fa-check-double"></i> Validar Frase
                </button>
                <button class="btn btn-purple" id="connect-btn">
                    <i class="fas fa-plug"></i> Conectar ao Ganache
                </button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs-container">
            <div class="tabs-header">
                <div class="tab active" data-tab="phrases">
                    <i class="fas fa-list"></i> Todas as Frases
                </div>
                <div class="tab" data-tab="valid">
                    <i class="fas fa-check-circle"></i> Frases Válidas
                </div>
                <div class="tab" data-tab="wallets">
                    <i class="fas fa-wallet"></i> Carteiras com Saldo
                </div>
                <div class="tab" data-tab="stats">
                    <i class="fas fa-chart-pie"></i> Estatísticas
                </div>
            </div>
            
            <!-- Phrases Tab -->
            <div class="tab-content active" id="phrases-tab">
                <div class="tab-toolbar">
                    <button class="btn btn-primary" id="save-phrases-btn">
                        <i class="fas fa-save"></i> Salvar
                    </button>
                    <button class="btn btn-warning" id="clear-phrases-btn">
                        <i class="fas fa-broom"></i> Limpar
                    </button>
                </div>
                <div class="console" id="phrases-console"></div>
            </div>
            
            <!-- Valid Phrases Tab -->
            <div class="tab-content" id="valid-tab">
                <div class="tab-toolbar">
                    <button class="btn btn-primary" id="save-valid-btn">
                        <i class="fas fa-save"></i> Salvar TXT
                    </button>
                    <button class="btn btn-warning" id="clear-valid-btn">
                        <i class="fas fa-broom"></i> Limpar
                    </button>
                </div>
                <div class="console" id="valid-console"></div>
            </div>
            
            <!-- Wallets Tab -->
            <div class="tab-content" id="wallets-tab">
                <div class="tab-toolbar">
                    <button class="btn btn-primary" id="save-wallets-btn">
                        <i class="fas fa-save"></i> Salvar JSON
                    </button>
                    <button class="btn btn-warning" id="clear-wallets-btn">
                        <i class="fas fa-broom"></i> Limpar
                    </button>
                    <button class="btn btn-success" id="copy-address-btn">
                        <i class="fas fa-copy"></i> Copiar Endereço
                    </button>
                </div>
                <div class="console" id="wallets-console"></div>
            </div>
            
            <!-- Stats Tab -->
            <div class="tab-content" id="stats-tab">
                <div class="console" id="stats-console">
                    <div class="console-line">Estatísticas em tempo real:</div>
                    <div class="console-line">--------------------------------</div>
                    <div class="console-line" id="stat-total">Total de Frases Geradas: 0</div>
                    <div class="console-line" id="stat-valid-count">Frases Válidas: 0</div>
                    <div class="console-line" id="stat-success-rate">Taxa de Sucesso: 0%</div>
                    <div class="console-line" id="stat-wallets-count">Carteiras com Saldo: 0</div>
                    <div class="console-line" id="stat-duplicates-count">Frases Duplicadas: 0</div>
                    <div class="console-line" id="stat-avg-speed">Velocidade Média: 0 frases/s</div>
                    <div class="console-line" id="stat-elapsed-time">Tempo Decorrido: 0s</div>
                    <div class="console-line" id="stat-efficiency-rate">Eficiência: 0%</div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-text" id="status-text">Pronto para iniciar</div>
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div class="memory-usage" id="memory-usage">Memória: --</div>
        </div>
    </div>

    <!-- Validate Modal -->
    <div class="modal" id="validate-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-check-double"></i> Validar Frase Manualmente</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Digite a frase mnemônica para validar:</p>
                <textarea class="modal-textarea" id="phrase-input" placeholder="Ex: word1 word2 word3 ..."></textarea>
                <div class="modal-result" id="validation-result"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" id="cancel-btn">Cancelar</button>
                <button class="btn btn-success" id="validate-phrase-btn">Validar</button>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div class="modal" id="loading-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-download"></i> Carregando Listas de Palavras</h3>
            </div>
            <div class="modal-body">
                <p>Carregando listas de palavras BIP39 do GitHub...</p>
                <div style="text-align: center; margin: 20px 0;">
                    <div class="loading" style="margin: 0 auto;"></div>
                </div>
                <div id="loading-status">Iniciando download das listas</div>
            </div>
        </div>
    </div>

    <script>
        // Estado da aplicação
        const state = {
            isRunning: false,
            totalPhrases: 0,
            validPhrases: 0,
            walletsFound: 0,
            duplicates: 0,
            startTime: 0,
            phrases: [],
            validPhrasesList: [],
            wallets: [],
            testedPhrases: new Set(),
            language: 'english',
            phraseSize: 12,
            bip39Wordlists: {},
            availableLanguages: [],
            web3: null,
            isConnected: false
        };

        // Elementos DOM
        const elements = {
            startBtn: document.getElementById('start-btn'),
            stopBtn: document.getElementById('stop-btn'),
            clearBtn: document.getElementById('clear-btn'),
            validateBtn: document.getElementById('validate-btn'),
            connectBtn: document.getElementById('connect-btn'),
            phrasesConsole: document.getElementById('phrases-console'),
            validConsole: document.getElementById('valid-console'),
            walletsConsole: document.getElementById('wallets-console'),
            progressBar: document.getElementById('progress-bar'),
            statusText: document.getElementById('status-text'),
            memoryUsage: document.getElementById('memory-usage'),
            validateModal: document.getElementById('validate-modal'),
            phraseInput: document.getElementById('phrase-input'),
            validationResult: document.getElementById('validation-result'),
            validatePhraseBtn: document.getElementById('validate-phrase-btn'),
            cancelBtn: document.getElementById('cancel-btn'),
            closeModal: document.querySelector('.close-modal'),
            tabs: document.querySelectorAll('.tab'),
            tabContents: document.querySelectorAll('.tab-content'),
            languageSelect: document.getElementById('language'),
            loadingModal: document.getElementById('loading-modal'),
            loadingStatus: document.getElementById('loading-status'),
            savePhrasesBtn: document.getElementById('save-phrases-btn'),
            clearPhrasesBtn: document.getElementById('clear-phrases-btn'),
            saveValidBtn: document.getElementById('save-valid-btn'),
            clearValidBtn: document.getElementById('clear-valid-btn'),
            saveWalletsBtn: document.getElementById('save-wallets-btn'),
            clearWalletsBtn: document.getElementById('clear-wallets-btn'),
            copyAddressBtn: document.getElementById('copy-address-btn'),
            ganacheUrl: document.getElementById('ganache-url'),
            discordWebhook: document.getElementById('discord-webhook'),
            connectionStatus: document.getElementById('connection-status')
        };

        // URLs das listas de palavras BIP39 do GitHub
        const wordlistUrls = {
            'english': 'https://raw.githubusercontent.com/bitcoin/bips/master/bip-0039/english.txt',
            'portuguese': 'https://raw.githubusercontent.com/bitcoin/bips/master/bip-0039/portuguese.txt',
            'spanish': 'https://raw.githubusercontent.com/bitcoin/bips/master/bip-0039/spanish.txt',
            'french': 'https://raw.githubusercontent.com/bitcoin/bips/master/bip-0039/french.txt',
            'italian': 'https://raw.githubusercontent.com/bitcoin/bips/master/bip-0039/italian.txt',
            'japanese': 'https://raw.githubusercontent.com/bitcoin/bips/master/bip-0039/japanese.txt',
            'korean': 'https://raw.githubusercontent.com/bitcoin/bips/master/bip-0039/korean.txt',
            'chinese_simplified': 'https://raw.githubusercontent.com/bitcoin/bips/master/bip-0039/chinese_simplified.txt',
            'chinese_traditional': 'https://raw.githubusercontent.com/bitcoin/bips/master/bip-0039/chinese_traditional.txt'
        };

        // Conectar ao Ganache
        async function connectToGanache() {
            const url = elements.ganacheUrl.value;
            
            try {
                addConsoleLine(elements.phrasesConsole, `🔌 Conectando ao Ganache: ${url}`);
                
                // Verificar se Web3 está disponível
                if (typeof Web3 === 'undefined') {
                    throw new Error('Web3 não está disponível. Verifique se o script foi carregado.');
                }
                
                state.web3 = new Web3(new Web3.providers.HttpProvider(url));
                
                // Testar a conexão
                const isConnected = await state.web3.eth.net.isListening();
                
                if (isConnected) {
                    state.isConnected = true;
                    const blockNumber = await state.web3.eth.getBlockNumber();
                    const accounts = await state.web3.eth.getAccounts();
                    
                    addConsoleLine(elements.phrasesConsole, `✅ Conectado ao Ganache. Bloco: ${blockNumber}, Contas: ${accounts.length}`, 'valid');
                    
                    // Atualizar status de conexão
                    elements.connectionStatus.innerHTML = '<i class="fas fa-circle status-connected"></i> <span>Conectado</span>';
                    
                    return true;
                } else {
                    throw new Error('Não foi possível conectar ao Ganache');
                }
            } catch (error) {
                addConsoleLine(elements.phrasesConsole, `❌ Erro ao conectar ao Ganache: ${error.message}`, 'invalid');
                elements.connectionStatus.innerHTML = '<i class="fas fa-circle status-disconnected"></i> <span>Desconectado</span>';
                return false;
            }
        }

        // Enviar mensagem para o Discord
        async function sendToDiscord(wallet) {
            const webhookUrl = elements.discordWebhook.value;
            
            if (!webhookUrl || !webhookUrl.includes('discord.com/api/webhooks')) {
                addConsoleLine(elements.phrasesConsole, '❌ Webhook do Discord não configurado corretamente', 'invalid');
                return false;
            }
            
            try {
                const embed = {
                    title: "💰 Carteira com Saldo Encontrada!",
                    color: 0x00ff00,
                    fields: [
                        {
                            name: "Frase Mnemônica",
                            value: "```" + wallet.phrase + "```",
                            inline: false
                        },
                        {
                            name: "Endereço",
                            value: "`" + wallet.address + "`",
                            inline: true
                        },
                        {
                            name: "Saldo",
                            value: "**" + wallet.balance + " ETH**",
                            inline: true
                        },
                        {
                            name: "Chave Privada",
                            value: "||`" + wallet.privateKey + "`||",
                            inline: false
                        }
                    ],
                    timestamp: new Date().toISOString(),
                    footer: {
                        text: "Mnemonic Master BIP39"
                    }
                };
                
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        embeds: [embed]
                    })
                });
                
                if (response.ok) {
                    addConsoleLine(elements.phrasesConsole, '📨 Informações enviadas para o Discord', 'valid');
                    return true;
                } else {
                    addConsoleLine(elements.phrasesConsole, '❌ Falha ao enviar para o Discord', 'invalid');
                    return false;
                }
            } catch (error) {
                addConsoleLine(elements.phrasesConsole, `❌ Erro ao enviar para o Discord: ${error.message}`, 'invalid');
                return false;
            }
        }

        // Carregar lista de palavras do GitHub
        async function loadWordlist(lang) {
            try {
                elements.loadingStatus.textContent = `Carregando ${lang}...`;
                const response = await fetch(wordlistUrls[lang]);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const text = await response.text();
                const words = text.trim().split('\n');
                
                if (words.length >= 2048) {
                    state.bip39Wordlists[lang] = words;
                    addConsoleLine(elements.phrasesConsole, `✅ ${lang}: ${words.length} palavras carregadas`, 'valid');
                    return true;
                } else {
                    addConsoleLine(elements.phrasesConsole, `❌ ${lang}: Lista incompleta (${words.length} palavras)`, 'invalid');
                    return false;
                }
            } catch (error) {
                addConsoleLine(elements.phrasesConsole, `❌ Erro ao carregar ${lang}: ${error.message}`, 'invalid');
                return false;
            }
        }

        // Carregar todas as listas de palavras
        async function loadAllWordlists() {
            elements.loadingModal.style.display = 'flex';
            
            let successCount = 0;
            const languages = Object.keys(wordlistUrls);
            
            for (const lang of languages) {
                const success = await loadWordlist(lang);
                if (success) {
                    successCount++;
                    state.availableLanguages.push(lang);
                }
            }
            
            elements.loadingModal.style.display = 'none';
            
            if (successCount > 0) {
                addConsoleLine(elements.phrasesConsole, `✅ ${successCount} listas carregadas com sucesso!`, 'valid');
                
                // Atualizar o dropdown de idiomas
                elements.languageSelect.innerHTML = '';
                state.availableLanguages.forEach(lang => {
                    const option = document.createElement('option');
                    option.value = lang;
                    option.textContent = lang.charAt(0).toUpperCase() + lang.slice(1);
                    elements.languageSelect.appendChild(option);
                });
                
                state.language = state.availableLanguages[0];
            } else {
                addConsoleLine(elements.phrasesConsole, '❌ Nenhuma lista pôde ser carregada. Verifique sua conexão.', 'invalid');
            }
        }

        // Atualizar elementos de estatísticas
        function updateStats() {
            document.getElementById('stat-phrases').textContent = state.totalPhrases.toLocaleString();
            document.getElementById('stat-time').textContent = `${((Date.now() - state.startTime) / 1000).toFixed(1)}s`;
            
            const elapsedSeconds = (Date.now() - state.startTime) / 1000;
            const speed = elapsedSeconds > 0 ? (state.totalPhrases / elapsedSeconds).toFixed(1) : '0';
            document.getElementById('stat-speed').textContent = `${speed} frases/s`;
            
            document.getElementById('stat-valid').textContent = state.validPhrases.toLocaleString();
            document.getElementById('stat-wallets').textContent = state.walletsFound.toLocaleString();
            document.getElementById('stat-duplicates').textContent = state.duplicates.toLocaleString();
            
            const efficiency = state.totalPhrases + state.duplicates > 0 ? 
                (state.totalPhrases / (state.totalPhrases + state.duplicates) * 100).toFixed(1) : '0';
            document.getElementById('stat-efficiency').textContent = `${efficiency}%`;
            
            // Atualizar estatísticas detalhadas
            document.getElementById('stat-total').textContent = `Total de Frases Geradas: ${state.totalPhrases.toLocaleString()}`;
            document.getElementById('stat-valid-count').textContent = `Frases Válidas: ${state.validPhrases.toLocaleString()}`;
            
            const successRate = state.totalPhrases > 0 ? (state.validPhrases / state.totalPhrases * 100).toFixed(2) : '0';
            document.getElementById('stat-success-rate').textContent = `Taxa de Sucesso: ${successRate}%`;
            
            document.getElementById('stat-wallets-count').textContent = `Carteiras com Saldo: ${state.walletsFound.toLocaleString()}`;
            document.getElementById('stat-duplicates-count').textContent = `Frases Duplicadas: ${state.duplicates.toLocaleString()}`;
            document.getElementById('stat-avg-speed').textContent = `Velocidade Média: ${speed} frases/s`;
            document.getElementById('stat-elapsed-time').textContent = `Tempo Decorrido: ${((Date.now() - state.startTime) / 1000).toFixed(1)}s`;
            document.getElementById('stat-efficiency-rate').textContent = `Eficiência: ${efficiency}%`;
            
            // Atualizar barra de progresso
            elements.progressBar.style.width = state.isRunning ? '50%' : '0%';
            
            // Atualizar uso de memória (simulado)
            const memoryUsage = 50 + Math.random() * 50;
            elements.memoryUsage.textContent = `Memória: ${memoryUsage.toFixed(1)} MB`;
        }

        // Adicionar linha ao console
        function addConsoleLine(consoleElement, message, className = '') {
            const timestamp = new Date().toLocaleTimeString();
            const line = document.createElement('div');
            line.className = `console-line ${className}`;
            line.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
            consoleElement.appendChild(line);
            consoleElement.scrollTop = consoleElement.scrollHeight;
        }

        // Gerar frase mnemônica
        function generateMnemonic() {
            const wordCount = parseInt(document.getElementById('phrase-size').value);
            const language = document.getElementById('language').value;
            
            if (!state.bip39Wordlists[language] || state.bip39Wordlists[language].length === 0) {
                addConsoleLine(elements.phrasesConsole, `❌ Lista de palavras para ${language} não carregada`, 'invalid');
                return null;
            }
            
            // Selecionar palavras aleatórias da lista
            const words = [];
            const wordlist = state.bip39Wordlists[language];
            
            for (let i = 0; i < wordCount; i++) {
                const randomIndex = Math.floor(Math.random() * wordlist.length);
                words.push(wordlist[randomIndex]);
            }
            
            return words.join(' ');
        }

        // Validar frase usando algoritmo BIP39
        function validateMnemonic(phrase, language) {
            if (!phrase || !state.bip39Wordlists[language]) return false;
            
            const words = phrase.split(' ');
            const wordlist = state.bip39Wordlists[language];
            
            // Verificar se todas as palavras estão na lista BIP39
            if (!words.every(word => wordlist.includes(word))) return false;
            
            // Verificar comprimento válido
            if (![12, 15, 18, 21, 24].includes(words.length)) return false;
            
            // Implementação simplificada do checksum BIP39
            try {
                // Em uma implementação real, aqui seria verificado o checksum
                // Para esta demonstração, vamos considerar que 70% das frases são válidas
                return Math.random() > 0.3;
            } catch (e) {
                return false;
            }
        }

        // Converter frase para endereço Ethereum usando Web3
        async function phraseToAddress(phrase) {
            try {
                // Simulação de conversão de frase para seed
                const encoder = new TextEncoder();
                const data = encoder.encode(phrase);
                const seed = await crypto.subtle.digest('SHA-256', data);
                
                // Usar o seed para criar uma conta (simulação)
                const hexString = Array.from(new Uint8Array(seed))
                    .map(b => b.toString(16).padStart(2, '0'))
                    .join('');
                
                // Usar os últimos 40 caracteres como endereço
                const address = '0x' + hexString.slice(-40);
                // Usar os primeiros 64 caracteres como chave privada
                const privateKey = hexString.slice(0, 64);
                
                return { address, privateKey };
            } catch (error) {
                addConsoleLine(elements.phrasesConsole, `❌ Erro ao converter frase: ${error.message}`, 'invalid');
                // Fallback: gerar um endereço aleatório
                const address = '0x' + Array.from({length: 40}, () => 
                    Math.floor(Math.random() * 16).toString(16)).join('');
                const privateKey = Array.from({length: 64}, () => 
                    Math.floor(Math.random() * 16).toString(16)).join('');
                return { address, privateKey };
            }
        }

        // Verificar saldo real usando Web3
        async function checkBalance(address) {
            if (!state.isConnected || !state.web3) {
                addConsoleLine(elements.phrasesConsole, '❌ Não conectado ao Ganache', 'invalid');
                return 0;
            }
            
            try {
                const balanceWei = await state.web3.eth.getBalance(address);
                const balanceEth = state.web3.utils.fromWei(balanceWei, 'ether');
                return parseFloat(balanceEth);
            } catch (error) {
                addConsoleLine(elements.phrasesConsole, `❌ Erro ao verificar saldo: ${error.message}`, 'invalid');
                return 0;
            }
        }

        // Processar frase
        async function processPhrase() {
            if (!state.isRunning) return;
            
            const phrase = generateMnemonic();
            if (!phrase) {
                setTimeout(processPhrase, 100);
                return;
            }
            
            // Verificar se já foi testada
            const phraseHash = await hashPhrase(phrase);
            if (state.testedPhrases.has(phraseHash)) {
                state.duplicates++;
                addConsoleLine(elements.phrasesConsole, `❌ DUPLICATA | ${phrase}`, 'duplicate');
                updateStats();
                setTimeout(processPhrase, 100);
                return;
            }
            
            state.testedPhrases.add(phraseHash);
            state.totalPhrases++;
            
            const language = document.getElementById('language').value;
            const isValid = validateMnemonic(phrase, language);
            if (isValid) state.validPhrases++;
            
            const { address, privateKey } = await phraseToAddress(phrase);
            const balance = await checkBalance(address);
            
            // Adicionar ao console
            const status = isValid ? '✅ VÁLIDA' : '❌ INVÁLIDA';
            addConsoleLine(elements.phrasesConsole, `${status} | ${phrase} | Saldo: ${balance.toFixed(6)} ETH`, 
                          isValid ? 'valid' : 'invalid');
            
            // Se for válida, adicionar ao console de válidas
            if (isValid) {
                addConsoleLine(elements.validConsole, phrase, 'valid');
                state.validPhrasesList.push({phrase, address, balance, timestamp: Date.now()});
            }
            
            // Se tiver saldo, adicionar ao console de carteiras
            if (balance > 0) {
                state.walletsFound++;
                const walletInfo = `💰 CARTEIRA ENCONTRADA COM SALDO!\n\nFrase: ${phrase}\nEndereço: ${address}\nChave Priv: ${privateKey}\nSaldo: ${balance.toFixed(6)} ETH\n${'-'.repeat(80)}`;
                addConsoleLine(elements.walletsConsole, walletInfo, 'valid');
                
                const walletData = { phrase, address, privateKey, balance, timestamp: Date.now() };
                state.wallets.push(walletData);
                
                // Alertar o usuário
                elements.statusText.innerHTML = `<span style="color: var(--success);">💰 Carteira com saldo encontrada!</span>`;
                
                // Enviar para o Discord
                await sendToDiscord(walletData);
            }
            
            updateStats();
            
            // Continuar processamento
            if (state.isRunning) {
                setTimeout(processPhrase, 100);
            }
        }

        // Função hash para frases
        async function hashPhrase(phrase) {
            const encoder = new TextEncoder();
            const data = encoder.encode(phrase);
            const hash = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // Iniciar geração
        function startGeneration() {
            if (state.isRunning) return;
            
            // Verificar se as listas de palavras foram carregadas
            if (state.availableLanguages.length === 0) {
                addConsoleLine(elements.phrasesConsole, '❌ Carregue as listas de palavras primeiro', 'invalid');
                return;
            }
            
            // Verificar se está conectado ao Ganache
            if (!state.isConnected) {
                addConsoleLine(elements.phrasesConsole, '❌ Conecte-se ao Ganache primeiro', 'invalid');
                return;
            }
            
            state.isRunning = true;
            state.startTime = Date.now();
            elements.statusText.textContent = 'Gerando frases...';
            elements.startBtn.disabled = true;
            elements.stopBtn.disabled = false;
            
            processPhrase();
        }

        // Parar geração
        function stopGeneration() {
            state.isRunning = false;
            elements.statusText.textContent = 'Parado';
            elements.startBtn.disabled = false;
            elements.stopBtn.disabled = true;
            elements.progressBar.style.width = '0%';
        }

        // Limpar consoles
        function clearConsoles() {
            elements.phrasesConsole.innerHTML = '';
            elements.validConsole.innerHTML = '';
            elements.walletsConsole.innerHTML = '';
            
            addConsoleLine(elements.phrasesConsole, '🧹 Saída limpa.');
            
            // Reset estatísticas
            state.totalPhrases = 0;
            state.validPhrases = 0;
            state.walletsFound = 0;
            state.duplicates = 0;
            state.validPhrasesList = [];
            state.wallets = [];
            state.testedPhrases.clear();
            
            updateStats();
        }

        // Validar frase manualmente
        async function validateManualPhrase() {
            const phrase = elements.phraseInput.value.trim();
            if (!phrase) {
                elements.validationResult.innerHTML = '<span style="color: var(--danger);">❌ Digite uma frase primeiro</span>';
                return;
            }
            
            // Verificar se já foi testada
            const phraseHash = await hashPhrase(phrase);
            if (state.testedPhrases.has(phraseHash)) {
                elements.validationResult.innerHTML = '<span style="color: var(--warning);">⚠️ Frase já testada anteriormente</span>';
                return;
            }
            
            const language = document.getElementById('language').value;
            const isValid = validateMnemonic(phrase, language);
            
            if (isValid) {
                const { address } = await phraseToAddress(phrase);
                const balance = await checkBalance(address);
                
                elements.validationResult.innerHTML = `<span style="color: var(--success);">✅ Frase VÁLIDA - BIP39 Compliant</span><br>
                                                      <span style="font-size: 12px;">Endereço: ${address}</span><br>
                                                      <span style="font-size: 12px;">Saldo: ${balance} ETH</span>`;
                state.testedPhrases.add(phraseHash);
                
                // Adicionar às listas
                state.validPhrasesList.push({phrase, address, balance, timestamp: Date.now()});
                addConsoleLine(elements.validConsole, phrase, 'valid');
                
                // Se tiver saldo, adicionar às carteiras
                if (balance > 0) {
                    state.walletsFound++;
                    addConsoleLine(elements.walletsConsole, `💰 CARTEIRA COM SALDO: ${phrase} | Saldo: ${balance} ETH`, 'valid');
                }
            } else {
                elements.validationResult.innerHTML = '<span style="color: var(--danger);">❌ Frase INVÁLIDA</span>';
            }
        }

        // Alternar abas
        function switchTab(tabName) {
            // Remover classe active de todas as abas e conteúdos
            elements.tabs.forEach(tab => tab.classList.remove('active'));
            elements.tabContents.forEach(content => content.classList.remove('active'));
            
            // Adicionar classe active à aba e conteúdo selecionados
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // Salvar frases em arquivo
        function saveToFile(content, filename, type = 'text/plain') {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Salvar frases válidas
        function saveValidPhrases() {
            if (state.validPhrasesList.length === 0) {
                addConsoleLine(elements.phrasesConsole, '❌ Nenhuma frase válida para salvar', 'invalid');
                return;
            }
            
            let content = 'FRASES MNEMÔNICAS BIP39 VÁLIDAS\n';
            content += '='.repeat(50) + '\n';
            content += `Gerado em: ${new Date().toLocaleString()}\n`;
            content += `Idioma: ${document.getElementById('language').value}\n`;
            content += `Total de frases: ${state.validPhrasesList.length}\n`;
            content += `Frases únicas testadas: ${state.testedPhrases.size}\n`;
            content += `Duplicatas evitadas: ${state.duplicates}\n`;
            content += '='.repeat(50) + '\n\n';
            
            state.validPhrasesList.forEach((item, i) => {
                content += `${(i + 1).toString().padStart(4, '0')}. ${item.phrase}\n`;
                content += `     Endereço: ${item.address}\n`;
                if (item.balance > 0) {
                    content += `     Saldo: ${item.balance} ETH ⭐\n`;
                }
                content += `     Timestamp: ${new Date(item.timestamp).toLocaleString()}\n\n`;
            });
            
            saveToFile(content, `frases_validas_${Date.now()}.txt`);
            addConsoleLine(elements.phrasesConsole, '💾 Frases válidas salvas com sucesso', 'valid');
        }

        // Salvar carteiras
        function saveWallets() {
            if (state.wallets.length === 0) {
                addConsoleLine(elements.phrasesConsole, '❌ Nenhuma carteira com saldo para salvar', 'invalid');
                return;
            }
            
            const content = JSON.stringify(state.wallets, null, 2);
            saveToFile(content, `carteiras_${Date.now()}.json`, 'application/json');
            addConsoleLine(elements.phrasesConsole, '💾 Carteiras salvas com sucesso', 'valid');
        }

        // Copiar endereço da última carteira
        function copyAddress() {
            if (state.wallets.length === 0) {
                addConsoleLine(elements.phrasesConsole, '❌ Nenhuma carteira com saldo para copiar', 'invalid');
                return;
            }
            
            const lastWallet = state.wallets[state.wallets.length - 1];
            navigator.clipboard.writeText(lastWallet.address)
                .then(() => {
                    addConsoleLine(elements.phrasesConsole, '📋 Endereço copiado para a área de transferência', 'valid');
                })
                .catch(err => {
                    addConsoleLine(elements.phrasesConsole, '❌ Falha ao copiar endereço', 'invalid');
                });
        }

        // Inicializar aplicação
        async function initApp() {
            // Event listeners
            elements.startBtn.addEventListener('click', startGeneration);
            elements.stopBtn.addEventListener('click', stopGeneration);
            elements.clearBtn.addEventListener('click', clearConsoles);
            elements.validateBtn.addEventListener('click', () => {
                elements.validateModal.style.display = 'flex';
            });
            elements.connectBtn.addEventListener('click', async () => {
                await connectToGanache();
            });
            elements.validatePhraseBtn.addEventListener('click', validateManualPhrase);
            elements.cancelBtn.addEventListener('click', () => {
                elements.validateModal.style.display = 'none';
            });
            elements.closeModal.addEventListener('click', () => {
                elements.validateModal.style.display = 'none';
            });
            elements.saveValidBtn.addEventListener('click', saveValidPhrases);
            elements.saveWalletsBtn.addEventListener('click', saveWallets);
            elements.copyAddressBtn.addEventListener('click', copyAddress);
            
            // Event listeners para abas
            elements.tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    switchTab(tab.getAttribute('data-tab'));
                });
            });
            
            // Desabilitar botão de parar inicialmente
            elements.stopBtn.disabled = true;
            
            // Mensagem inicial
            addConsoleLine(elements.phrasesConsole, '🚀 Mnemonic Master BIP39 inicializado.');
            addConsoleLine(elements.phrasesConsole, '📥 Baixando listas de palavras BIP39 do GitHub...');
            
            // Carregar listas de palavras
            await loadAllWordlists();
            
            addConsoleLine(elements.phrasesConsole, '🔌 Conecte-se ao Ganache para verificar saldos reais.');
            addConsoleLine(elements.phrasesConsole, '🔤 Selecione as configurações e clique em "Iniciar Geração".');
            
            // Iniciar atualização de estatísticas
            setInterval(updateStats, 1000);
        }

        // Iniciar quando o documento estiver carregado
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
